<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: Stomp::Connection [Stomp]</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <link href='../../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Class</span>
          Stomp::Connection
        </h1>
        <ol class='paths'>
          <li>
            <a href="../../files/lib/stomp/connection_rb.html">lib/stomp/connection.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong>Object</strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <p>
            Low level connection which maps commands and supports synchronous receives
            </p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public class</h3>
            <ol>
              <li><a href="#M000030">default_port</a></li>
              <li><a href="#M000031">new</a></li>
              <li><a href="#M000033">open</a></li>
            </ol>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000054">__old_receive</a></li>
              <li><a href="#M000044">abort</a></li>
              <li><a href="#M000042">ack</a></li>
              <li><a href="#M000041">begin</a></li>
              <li><a href="#M000036">change_host</a></li>
              <li><a href="#M000051">client_ack?</a></li>
              <li><a href="#M000040">closed?</a></li>
              <li><a href="#M000043">commit</a></li>
              <li><a href="#M000052">disconnect</a></li>
              <li><a href="#M000032">hashed_initialize</a></li>
              <li><a href="#M000038">increase_reconnect_delay</a></li>
              <li><a href="#M000037">max_reconnect_attempts?</a></li>
              <li><a href="#M000048">obj_send</a></li>
              <li><a href="#M000039">open?</a></li>
              <li><a href="#M000053">poll</a></li>
              <li><a href="#M000047">publish</a></li>
              <li><a href="#M000055">receive</a></li>
              <li><a href="#M000035">refine_params</a></li>
              <li><a href="#M000049">send</a></li>
              <li><a href="#M000034">socket</a></li>
              <li><a href="#M000045">subscribe</a></li>
              <li><a href="#M000050">unreceive</a></li>
              <li><a href="#M000046">unsubscribe</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>connection_frame</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>disconnect_receipt</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public class methods</h2>
              <div class='method public-class' id='method-M000030'>
                <a name='M000030'></a>
                <div class='synopsis'>
                  <span class='name'>default_port</span>
                  <span class='arguments'>(ssl)</span>
                </div>
                <div class='description'>
                  <p>
                  alias :<a href="Connection.html#M000048">obj_send</a> :send
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000030-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000030-source'>    <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 13</span>&#x000A;13:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">default_port</span>(<span class="ruby-identifier">ssl</span>)&#x000A;14:       <span class="ruby-identifier">ssl</span> <span class="ruby-value">? </span><span class="ruby-value">61612</span> <span class="ruby-operator">:</span> <span class="ruby-value">61613</span>&#x000A;15:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-M000031'>
                <a name='M000031'></a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>(login = '', passcode = '', host = 'localhost', port = 61613, reliable = false, reconnect_delay = 5, connect_headers = {})</span>
                </div>
                <div class='description'>
                  <p>
                  A new <a href="Connection.html">Connection</a> object accepts the following
                  parameters:
                  </p>
                  <pre>login             (String,  default : '')&#x000A;passcode          (String,  default : '')&#x000A;host              (String,  default : 'localhost')&#x000A;port              (Integer, default : 61613)&#x000A;reliable          (Boolean, default : false)&#x000A;reconnect_delay   (Integer, default : 5)&#x000A;&#x000A;e.g. c = Connection.new(&quot;username&quot;, &quot;password&quot;, &quot;localhost&quot;, 61613, true)</pre>
                  <p>
                  Hash:
                  </p>
                  <pre>hash = {&#x000A;  :hosts =&gt; [&#x000A;    {:login =&gt; &quot;login1&quot;, :passcode =&gt; &quot;passcode1&quot;, :host =&gt; &quot;localhost&quot;, :port =&gt; 61616, :ssl =&gt; false},&#x000A;    {:login =&gt; &quot;login2&quot;, :passcode =&gt; &quot;passcode2&quot;, :host =&gt; &quot;remotehost&quot;, :port =&gt; 61617, :ssl =&gt; false}&#x000A;  ],&#x000A;  :initial_reconnect_delay =&gt; 0.01,&#x000A;  :max_reconnect_delay =&gt; 30.0,&#x000A;  :use_exponential_back_off =&gt; true,&#x000A;  :back_off_multiplier =&gt; 2,&#x000A;  :max_reconnect_attempts =&gt; 0,&#x000A;  :randomize =&gt; false,&#x000A;  :backup =&gt; false,&#x000A;  :timeout =&gt; -1&#x000A;}&#x000A;&#x000A;e.g. c = Connection.new(hash)</pre>
                  <p>
                  TODO <a href="../Stomp.html">Stomp</a> URL :
                  </p>
                  <pre>A Stomp URL must begin with 'stomp://' and can be in one of the following forms:&#x000A;&#x000A;stomp://host:port&#x000A;stomp://host.domain.tld:port&#x000A;stomp://user:pass@host:port&#x000A;stomp://user:pass@host.domain.tld:port</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000031-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000031-source'>    <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 56</span>&#x000A;56:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">login</span> = <span class="ruby-value str">''</span>, <span class="ruby-identifier">passcode</span> = <span class="ruby-value str">''</span>, <span class="ruby-identifier">host</span> = <span class="ruby-value str">'localhost'</span>, <span class="ruby-identifier">port</span> = <span class="ruby-value">61613</span>, <span class="ruby-identifier">reliable</span> = <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">reconnect_delay</span> = <span class="ruby-value">5</span>, <span class="ruby-identifier">connect_headers</span> = {})&#x000A;57:       <span class="ruby-ivar">@received_messages</span> = []&#x000A;58: &#x000A;59:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">login</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)&#x000A;60:         <span class="ruby-identifier">hashed_initialize</span>(<span class="ruby-identifier">login</span>)&#x000A;61:       <span class="ruby-keyword kw">else</span>&#x000A;62:         <span class="ruby-ivar">@host</span> = <span class="ruby-identifier">host</span>&#x000A;63:         <span class="ruby-ivar">@port</span> = <span class="ruby-identifier">port</span>&#x000A;64:         <span class="ruby-ivar">@login</span> = <span class="ruby-identifier">login</span>&#x000A;65:         <span class="ruby-ivar">@passcode</span> = <span class="ruby-identifier">passcode</span>&#x000A;66:         <span class="ruby-ivar">@reliable</span> = <span class="ruby-identifier">reliable</span>&#x000A;67:         <span class="ruby-ivar">@reconnect_delay</span> = <span class="ruby-identifier">reconnect_delay</span>&#x000A;68:         <span class="ruby-ivar">@connect_headers</span> = <span class="ruby-identifier">connect_headers</span>&#x000A;69:         <span class="ruby-ivar">@ssl</span> = <span class="ruby-keyword kw">false</span>&#x000A;70:         <span class="ruby-ivar">@parameters</span> = <span class="ruby-keyword kw">nil</span>&#x000A;71:       <span class="ruby-keyword kw">end</span>&#x000A;72:       &#x000A;73:       <span class="ruby-comment cmt"># Use Mutexes:  only one lock per each thread</span>&#x000A;74:       <span class="ruby-comment cmt"># Revert to original implementation attempt</span>&#x000A;75:       <span class="ruby-ivar">@transmit_semaphore</span> = <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span>&#x000A;76:       <span class="ruby-ivar">@read_semaphore</span> = <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span>&#x000A;77:       <span class="ruby-ivar">@socket_semaphore</span> = <span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span>&#x000A;78:       &#x000A;79:       <span class="ruby-ivar">@subscriptions</span> = {}&#x000A;80:       <span class="ruby-ivar">@failure</span> = <span class="ruby-keyword kw">nil</span>&#x000A;81:       <span class="ruby-ivar">@connection_attempts</span> = <span class="ruby-value">0</span>&#x000A;82:       &#x000A;83:       <span class="ruby-identifier">socket</span>&#x000A;84:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-class' id='method-M000033'>
                <a name='M000033'></a>
                <div class='synopsis'>
                  <span class='name'>open</span>
                  <span class='arguments'>(login = '', passcode = '', host = 'localhost', port = 61613, reliable = false, reconnect_delay = 5, connect_headers = {})</span>
                </div>
                <div class='description'>
                  <p>
                  Syntactic sugar for &#8216;<a
                  href="Connection.html#M000031">Connection.new</a>&#8217; See
                  &#8216;initialize&#8217; for usage.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000033-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000033-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 98</span>&#x000A; 98:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Connection</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">login</span> = <span class="ruby-value str">''</span>, <span class="ruby-identifier">passcode</span> = <span class="ruby-value str">''</span>, <span class="ruby-identifier">host</span> = <span class="ruby-value str">'localhost'</span>, <span class="ruby-identifier">port</span> = <span class="ruby-value">61613</span>, <span class="ruby-identifier">reliable</span> = <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">reconnect_delay</span> = <span class="ruby-value">5</span>, <span class="ruby-identifier">connect_headers</span> = {})&#x000A; 99:       <span class="ruby-constant">Connection</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">login</span>, <span class="ruby-identifier">passcode</span>, <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>, <span class="ruby-identifier">reliable</span>, <span class="ruby-identifier">reconnect_delay</span>, <span class="ruby-identifier">connect_headers</span>)&#x000A;100:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Public instance methods</h2>
              <div class='method public-instance' id='method-M000054'>
                <a name='M000054'></a>
                <div class='synopsis'>
                  <span class='name'>__old_receive</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Receive a frame, block until the frame is received
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000054-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000054-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 320</span>&#x000A;320:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">__old_receive</span>&#x000A;321:       <span class="ruby-comment cmt"># The recive my fail so we may need to retry.</span>&#x000A;322:       <span class="ruby-keyword kw">while</span> <span class="ruby-constant">TRUE</span>&#x000A;323:         <span class="ruby-keyword kw">begin</span>&#x000A;324:           <span class="ruby-identifier">used_socket</span> = <span class="ruby-identifier">socket</span>&#x000A;325:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">_receive</span>(<span class="ruby-identifier">used_socket</span>)&#x000A;326:         <span class="ruby-keyword kw">rescue</span>&#x000A;327:           <span class="ruby-ivar">@failure</span> = <span class="ruby-identifier">$!</span>&#x000A;328:           <span class="ruby-identifier">raise</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@reliable</span>&#x000A;329:           <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-node">&quot;receive failed: #{$!}&quot;</span>&#x000A;330:         <span class="ruby-keyword kw">end</span>&#x000A;331:       <span class="ruby-keyword kw">end</span>&#x000A;332:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000044'>
                <a name='M000044'></a>
                <div class='synopsis'>
                  <span class='name'>abort</span>
                  <span class='arguments'>(name, headers = {})</span>
                </div>
                <div class='description'>
                  <p>
                  Abort a transaction by name
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000044-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000044-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 217</span>&#x000A;217:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">abort</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">headers</span> = {})&#x000A;218:       <span class="ruby-identifier">headers</span>[<span class="ruby-identifier">:transaction</span>] = <span class="ruby-identifier">name</span>&#x000A;219:       <span class="ruby-identifier">transmit</span>(<span class="ruby-value str">&quot;ABORT&quot;</span>, <span class="ruby-identifier">headers</span>)&#x000A;220:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000042'>
                <a name='M000042'></a>
                <div class='synopsis'>
                  <span class='name'>ack</span>
                  <span class='arguments'>(message_id, headers = {})</span>
                </div>
                <div class='description'>
                  <p>
                  Acknowledge a message, used when a subscription has specified client
                  acknowledgement ( connection.subscribe &#8220;/queue/a&#8220;, :ack =>
                  &#8216;client&#8217;g
                  </p>
                  <p>
                  Accepts a transaction header ( :transaction =>
                  &#8216;some_transaction_id&#8217; )
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000042-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000042-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 205</span>&#x000A;205:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ack</span>(<span class="ruby-identifier">message_id</span>, <span class="ruby-identifier">headers</span> = {})&#x000A;206:       <span class="ruby-identifier">headers</span>[<span class="ruby-value str">'message-id'</span>] = <span class="ruby-identifier">message_id</span>&#x000A;207:       <span class="ruby-identifier">transmit</span>(<span class="ruby-value str">&quot;ACK&quot;</span>, <span class="ruby-identifier">headers</span>)&#x000A;208:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000041'>
                <a name='M000041'></a>
                <div class='synopsis'>
                  <span class='name'>begin</span>
                  <span class='arguments'>(name, headers = {})</span>
                </div>
                <div class='description'>
                  <p>
                  Begin a transaction, requires a name for the transaction
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000041-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000041-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 196</span>&#x000A;196:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">begin</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">headers</span> = {})&#x000A;197:       <span class="ruby-identifier">headers</span>[<span class="ruby-identifier">:transaction</span>] = <span class="ruby-identifier">name</span>&#x000A;198:       <span class="ruby-identifier">transmit</span>(<span class="ruby-value str">&quot;BEGIN&quot;</span>, <span class="ruby-identifier">headers</span>)&#x000A;199:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000036'>
                <a name='M000036'></a>
                <div class='synopsis'>
                  <span class='name'>change_host</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000036-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000036-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 158</span>&#x000A;158:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">change_host</span>&#x000A;159:       <span class="ruby-ivar">@parameters</span>[<span class="ruby-identifier">:hosts</span>] = <span class="ruby-ivar">@parameters</span>[<span class="ruby-identifier">:hosts</span>].<span class="ruby-identifier">sort_by</span> { <span class="ruby-identifier">rand</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@parameters</span>[<span class="ruby-identifier">:randomize</span>]&#x000A;160:       &#x000A;161:       <span class="ruby-comment cmt"># Set first as master and send it to the end of array</span>&#x000A;162:       <span class="ruby-identifier">current_host</span> = <span class="ruby-ivar">@parameters</span>[<span class="ruby-identifier">:hosts</span>].<span class="ruby-identifier">shift</span>&#x000A;163:       <span class="ruby-ivar">@parameters</span>[<span class="ruby-identifier">:hosts</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">current_host</span>&#x000A;164:       &#x000A;165:       <span class="ruby-ivar">@ssl</span> = <span class="ruby-identifier">current_host</span>[<span class="ruby-identifier">:ssl</span>]&#x000A;166:       <span class="ruby-ivar">@host</span> = <span class="ruby-identifier">current_host</span>[<span class="ruby-identifier">:host</span>]&#x000A;167:       <span class="ruby-ivar">@port</span> = <span class="ruby-identifier">current_host</span>[<span class="ruby-identifier">:port</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Connection</span><span class="ruby-operator">::</span><span class="ruby-identifier">default_port</span>(<span class="ruby-ivar">@ssl</span>)&#x000A;168:       <span class="ruby-ivar">@login</span> = <span class="ruby-identifier">current_host</span>[<span class="ruby-identifier">:login</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>&#x000A;169:       <span class="ruby-ivar">@passcode</span> = <span class="ruby-identifier">current_host</span>[<span class="ruby-identifier">:passcode</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>&#x000A;170:       &#x000A;171:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000051'>
                <a name='M000051'></a>
                <div class='synopsis'>
                  <span class='name'>client_ack?</span>
                  <span class='arguments'>(message)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000051-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000051-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 297</span>&#x000A;297:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">client_ack?</span>(<span class="ruby-identifier">message</span>)&#x000A;298:       <span class="ruby-identifier">headers</span> = <span class="ruby-ivar">@subscriptions</span>[<span class="ruby-identifier">message</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-identifier">:destination</span>]]&#x000A;299:       <span class="ruby-operator">!</span><span class="ruby-identifier">headers</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">headers</span>[<span class="ruby-identifier">:ack</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;client&quot;</span>&#x000A;300:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000040'>
                <a name='M000040'></a>
                <div class='synopsis'>
                  <span class='name'>closed?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Is this connection closed?
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000040-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000040-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 191</span>&#x000A;191:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">closed?</span>&#x000A;192:       <span class="ruby-ivar">@closed</span>&#x000A;193:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000043'>
                <a name='M000043'></a>
                <div class='synopsis'>
                  <span class='name'>commit</span>
                  <span class='arguments'>(name, headers = {})</span>
                </div>
                <div class='description'>
                  <p>
                  Commit a transaction by name
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000043-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000043-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 211</span>&#x000A;211:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">commit</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">headers</span> = {})&#x000A;212:       <span class="ruby-identifier">headers</span>[<span class="ruby-identifier">:transaction</span>] = <span class="ruby-identifier">name</span>&#x000A;213:       <span class="ruby-identifier">transmit</span>(<span class="ruby-value str">&quot;COMMIT&quot;</span>, <span class="ruby-identifier">headers</span>)&#x000A;214:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000052'>
                <a name='M000052'></a>
                <div class='synopsis'>
                  <span class='name'>disconnect</span>
                  <span class='arguments'>(headers = {})</span>
                </div>
                <div class='description'>
                  <p>
                  Close this connection
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000052-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000052-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 303</span>&#x000A;303:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">disconnect</span>(<span class="ruby-identifier">headers</span> = {})&#x000A;304:       <span class="ruby-identifier">transmit</span>(<span class="ruby-value str">&quot;DISCONNECT&quot;</span>, <span class="ruby-identifier">headers</span>)&#x000A;305:       <span class="ruby-identifier">headers</span> = <span class="ruby-identifier">headers</span>.<span class="ruby-identifier">symbolize_keys</span>&#x000A;306:       <span class="ruby-ivar">@disconnect_receipt</span> = <span class="ruby-identifier">receive</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">headers</span>[<span class="ruby-identifier">:receipt</span>]&#x000A;307:       <span class="ruby-identifier">close_socket</span>&#x000A;308:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000032'>
                <a name='M000032'></a>
                <div class='synopsis'>
                  <span class='name'>hashed_initialize</span>
                  <span class='arguments'>(params)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000032-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000032-source'>    <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 86</span>&#x000A;86:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hashed_initialize</span>(<span class="ruby-identifier">params</span>)&#x000A;87:       &#x000A;88:       <span class="ruby-ivar">@parameters</span> = <span class="ruby-identifier">refine_params</span>(<span class="ruby-identifier">params</span>)&#x000A;89:       <span class="ruby-ivar">@reliable</span> = <span class="ruby-keyword kw">true</span>&#x000A;90:       <span class="ruby-ivar">@reconnect_delay</span> = <span class="ruby-ivar">@parameters</span>[<span class="ruby-identifier">:initial_reconnect_delay</span>]&#x000A;91:       <span class="ruby-ivar">@connect_headers</span> = <span class="ruby-ivar">@parameters</span>[<span class="ruby-identifier">:connect_headers</span>]&#x000A;92:       &#x000A;93:       <span class="ruby-comment cmt">#sets the first host to connect</span>&#x000A;94:       <span class="ruby-identifier">change_host</span>&#x000A;95:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000038'>
                <a name='M000038'></a>
                <div class='synopsis'>
                  <span class='name'>increase_reconnect_delay</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000038-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000038-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 177</span>&#x000A;177:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">increase_reconnect_delay</span>&#x000A;178: &#x000A;179:       <span class="ruby-ivar">@reconnect_delay</span> <span class="ruby-operator">*=</span> <span class="ruby-ivar">@parameters</span>[<span class="ruby-identifier">:back_off_multiplier</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@parameters</span>[<span class="ruby-identifier">:use_exponential_back_off</span>] &#x000A;180:       <span class="ruby-ivar">@reconnect_delay</span> = <span class="ruby-ivar">@parameters</span>[<span class="ruby-identifier">:max_reconnect_delay</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@reconnect_delay</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@parameters</span>[<span class="ruby-identifier">:max_reconnect_delay</span>]&#x000A;181:       &#x000A;182:       <span class="ruby-ivar">@reconnect_delay</span>&#x000A;183:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000037'>
                <a name='M000037'></a>
                <div class='synopsis'>
                  <span class='name'>max_reconnect_attempts?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000037-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000037-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 173</span>&#x000A;173:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">max_reconnect_attempts?</span>&#x000A;174:       <span class="ruby-operator">!</span>(<span class="ruby-ivar">@parameters</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@parameters</span>[<span class="ruby-identifier">:max_reconnect_attempts</span>].<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@parameters</span>[<span class="ruby-identifier">:max_reconnect_attempts</span>] <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@connection_attempts</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@parameters</span>[<span class="ruby-identifier">:max_reconnect_attempts</span>]&#x000A;175:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000048'>
                <a name='M000048'></a>
                <div class='synopsis'>
                  <span class='name'>obj_send</span>
                  <span class='arguments'>(*args)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000048-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000048-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 253</span>&#x000A;253:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">obj_send</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)&#x000A;254:       <span class="ruby-identifier">__send__</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)&#x000A;255:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000039'>
                <a name='M000039'></a>
                <div class='synopsis'>
                  <span class='name'>open?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Is this connection open?
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000039-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000039-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 186</span>&#x000A;186:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">open?</span>&#x000A;187:       <span class="ruby-operator">!</span><span class="ruby-ivar">@closed</span>&#x000A;188:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000053'>
                <a name='M000053'></a>
                <div class='synopsis'>
                  <span class='name'>poll</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Return a pending message if one is available, otherwise return nil
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000053-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000053-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 312</span>&#x000A;312:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">poll</span>&#x000A;313:       <span class="ruby-comment cmt"># No need for a read lock here.  The receive method eventually fullfills</span>&#x000A;314:       <span class="ruby-comment cmt"># that requirement.</span>&#x000A;315:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">ready?</span>&#x000A;316:       <span class="ruby-identifier">receive</span>&#x000A;317:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000047'>
                <a name='M000047'></a>
                <div class='synopsis'>
                  <span class='name'>publish</span>
                  <span class='arguments'>(destination, message, headers = {})</span>
                </div>
                <div class='description'>
                  <p>
                  Publish message to destination
                  </p>
                  <p>
                  To disable content length header ( :suppress_content_length => true )
                  Accepts a transaction header ( :transaction =>
                  &#8216;some_transaction_id&#8217; )
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000047-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000047-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 248</span>&#x000A;248:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">publish</span>(<span class="ruby-identifier">destination</span>, <span class="ruby-identifier">message</span>, <span class="ruby-identifier">headers</span> = {})&#x000A;249:       <span class="ruby-identifier">headers</span>[<span class="ruby-identifier">:destination</span>] = <span class="ruby-identifier">destination</span>&#x000A;250:       <span class="ruby-identifier">transmit</span>(<span class="ruby-value str">&quot;SEND&quot;</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">message</span>)&#x000A;251:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000055'>
                <a name='M000055'></a>
                <div class='synopsis'>
                  <span class='name'>receive</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000055-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000055-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 334</span>&#x000A;334:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">receive</span>&#x000A;335:       <span class="ruby-identifier">super_result</span> = <span class="ruby-identifier">__old_receive</span>&#x000A;336:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">super_result</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@reliable</span>&#x000A;337:         <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-value str">&quot;connection.receive returning EOF as nil - resetting connection.\n&quot;</span>&#x000A;338:         <span class="ruby-ivar">@socket</span> = <span class="ruby-keyword kw">nil</span>&#x000A;339:         <span class="ruby-identifier">super_result</span> = <span class="ruby-identifier">__old_receive</span>&#x000A;340:       <span class="ruby-keyword kw">end</span>&#x000A;341:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">super_result</span>&#x000A;342:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000035'>
                <a name='M000035'></a>
                <div class='synopsis'>
                  <span class='name'>refine_params</span>
                  <span class='arguments'>(params)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000035-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000035-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 138</span>&#x000A;138:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">refine_params</span>(<span class="ruby-identifier">params</span>)&#x000A;139:       <span class="ruby-identifier">params</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">uncamelize_and_symbolize_keys</span>&#x000A;140:       &#x000A;141:       <span class="ruby-identifier">default_params</span> = {&#x000A;142:         <span class="ruby-identifier">:connect_headers</span> =<span class="ruby-operator">&gt;</span> {},&#x000A;143:         <span class="ruby-comment cmt"># Failover parameters</span>&#x000A;144:         <span class="ruby-identifier">:initial_reconnect_delay</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-value">.01</span>,&#x000A;145:         <span class="ruby-identifier">:max_reconnect_delay</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">30.0</span>,&#x000A;146:         <span class="ruby-identifier">:use_exponential_back_off</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,&#x000A;147:         <span class="ruby-identifier">:back_off_multiplier</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>,&#x000A;148:         <span class="ruby-identifier">:max_reconnect_attempts</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,&#x000A;149:         <span class="ruby-identifier">:randomize</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>,&#x000A;150:         <span class="ruby-identifier">:backup</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>,&#x000A;151:         <span class="ruby-identifier">:timeout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">-1</span>&#x000A;152:       }&#x000A;153:       &#x000A;154:       <span class="ruby-identifier">default_params</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">params</span>)&#x000A;155:         &#x000A;156:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000049'>
                <a name='M000049'></a>
                <div class='synopsis'>
                  <span class='name'>send</span>
                  <span class='arguments'>(*args)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000049-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000049-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 257</span>&#x000A;257:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)&#x000A;258:       <span class="ruby-identifier">warn</span>(<span class="ruby-value str">&quot;This method is deprecated and will be removed on the next release. Use 'publish' instead&quot;</span>)&#x000A;259:       <span class="ruby-identifier">publish</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)&#x000A;260:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000034'>
                <a name='M000034'></a>
                <div class='synopsis'>
                  <span class='name'>socket</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000034-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000034-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 102</span>&#x000A;102:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">socket</span>&#x000A;103:       <span class="ruby-ivar">@socket_semaphore</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>&#x000A;104:         <span class="ruby-identifier">used_socket</span> = <span class="ruby-ivar">@socket</span>&#x000A;105:         <span class="ruby-identifier">used_socket</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">closed?</span>&#x000A;106:         &#x000A;107:         <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">used_socket</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@failure</span>.<span class="ruby-identifier">nil?</span>&#x000A;108:           <span class="ruby-ivar">@failure</span> = <span class="ruby-keyword kw">nil</span>&#x000A;109:           <span class="ruby-keyword kw">begin</span>&#x000A;110:             <span class="ruby-identifier">used_socket</span> = <span class="ruby-identifier">open_socket</span>&#x000A;111:             <span class="ruby-comment cmt"># Open complete</span>&#x000A;112:             &#x000A;113:             <span class="ruby-identifier">connect</span>(<span class="ruby-identifier">used_socket</span>)&#x000A;114:             &#x000A;115:             <span class="ruby-ivar">@connection_attempts</span> = <span class="ruby-value">0</span>&#x000A;116:           <span class="ruby-keyword kw">rescue</span>&#x000A;117:             <span class="ruby-ivar">@failure</span> = <span class="ruby-identifier">$!</span>&#x000A;118:             <span class="ruby-identifier">used_socket</span> = <span class="ruby-keyword kw">nil</span>&#x000A;119:             <span class="ruby-identifier">raise</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@reliable</span>&#x000A;120:             <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">print</span> <span class="ruby-node">&quot;connect to #{@host} failed: #{$!} will retry(##{@connection_attempts}) in #{@reconnect_delay}\n&quot;</span>&#x000A;121: &#x000A;122:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">Stomp</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span><span class="ruby-operator">::</span><span class="ruby-constant">MaxReconnectAttempts</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">max_reconnect_attempts?</span>&#x000A;123: &#x000A;124:             <span class="ruby-identifier">sleep</span>(<span class="ruby-ivar">@reconnect_delay</span>)&#x000A;125:             &#x000A;126:             <span class="ruby-ivar">@connection_attempts</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>&#x000A;127:             &#x000A;128:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@parameters</span>&#x000A;129:               <span class="ruby-identifier">change_host</span>&#x000A;130:               <span class="ruby-identifier">increase_reconnect_delay</span>&#x000A;131:             <span class="ruby-keyword kw">end</span>&#x000A;132:           <span class="ruby-keyword kw">end</span>&#x000A;133:         <span class="ruby-keyword kw">end</span>&#x000A;134:         <span class="ruby-ivar">@socket</span> = <span class="ruby-identifier">used_socket</span>&#x000A;135:       <span class="ruby-keyword kw">end</span>&#x000A;136:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000045'>
                <a name='M000045'></a>
                <div class='synopsis'>
                  <span class='name'>subscribe</span>
                  <span class='arguments'>(name, headers = {}, subId = nil)</span>
                </div>
                <div class='description'>
                  <p>
                  Subscribe to a destination, must specify a name
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000045-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000045-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 223</span>&#x000A;223:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">subscribe</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">headers</span> = {}, <span class="ruby-identifier">subId</span> = <span class="ruby-keyword kw">nil</span>)&#x000A;224:       <span class="ruby-identifier">headers</span>[<span class="ruby-identifier">:destination</span>] = <span class="ruby-identifier">name</span>&#x000A;225:       <span class="ruby-identifier">transmit</span>(<span class="ruby-value str">&quot;SUBSCRIBE&quot;</span>, <span class="ruby-identifier">headers</span>)&#x000A;226: &#x000A;227:       <span class="ruby-comment cmt"># Store the sub so that we can replay if we reconnect.</span>&#x000A;228:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@reliable</span>&#x000A;229:         <span class="ruby-identifier">subId</span> = <span class="ruby-identifier">name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">subId</span>.<span class="ruby-identifier">nil?</span>&#x000A;230:         <span class="ruby-ivar">@subscriptions</span>[<span class="ruby-identifier">subId</span>] = <span class="ruby-identifier">headers</span>&#x000A;231:       <span class="ruby-keyword kw">end</span>&#x000A;232:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000050'>
                <a name='M000050'></a>
                <div class='synopsis'>
                  <span class='name'>unreceive</span>
                  <span class='arguments'>(message, options = {})</span>
                </div>
                <div class='description'>
                  <p>
                  Send a message back to the source or to the dead letter queue
                  </p>
                  <p>
                  Accepts a dead letter queue option ( :dead_letter_queue =>
                  &#8220;/queue/DLQ&#8220; ) Accepts a limit number of redeliveries option (
                  :max_redeliveries => 6 ) Accepts a force client acknowledgement option
                  (:force_client_ack => true)
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000050-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000050-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 267</span>&#x000A;267:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unreceive</span>(<span class="ruby-identifier">message</span>, <span class="ruby-identifier">options</span> = {})&#x000A;268:       <span class="ruby-identifier">options</span> = { <span class="ruby-identifier">:dead_letter_queue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/queue/DLQ&quot;</span>, <span class="ruby-identifier">:max_redeliveries</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">6</span> }.<span class="ruby-identifier">merge</span> <span class="ruby-identifier">options</span>&#x000A;269:       <span class="ruby-comment cmt"># Lets make sure all keys are symbols</span>&#x000A;270:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">headers</span> = <span class="ruby-identifier">message</span>.<span class="ruby-identifier">headers</span>.<span class="ruby-identifier">symbolize_keys</span>&#x000A;271:       &#x000A;272:       <span class="ruby-identifier">retry_count</span> = <span class="ruby-identifier">message</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-identifier">:retry_count</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>&#x000A;273:       <span class="ruby-identifier">message</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-identifier">:retry_count</span>] = <span class="ruby-identifier">retry_count</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>&#x000A;274:       <span class="ruby-identifier">transaction_id</span> = <span class="ruby-node">&quot;transaction-#{message.headers[:'message-id']}-#{retry_count}&quot;</span>&#x000A;275:       <span class="ruby-identifier">message_id</span> = <span class="ruby-identifier">message</span>.<span class="ruby-identifier">headers</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:'message-id'</span>)&#x000A;276:       &#x000A;277:       <span class="ruby-keyword kw">begin</span>&#x000A;278:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">begin</span> <span class="ruby-identifier">transaction_id</span>&#x000A;279:         &#x000A;280:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">client_ack?</span>(<span class="ruby-identifier">message</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:force_client_ack</span>]&#x000A;281:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">ack</span>(<span class="ruby-identifier">message_id</span>, <span class="ruby-identifier">:transaction</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">transaction_id</span>)&#x000A;282:         <span class="ruby-keyword kw">end</span>&#x000A;283:         &#x000A;284:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">retry_count</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:max_redeliveries</span>]&#x000A;285:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">publish</span>(<span class="ruby-identifier">message</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-identifier">:destination</span>], <span class="ruby-identifier">message</span>.<span class="ruby-identifier">body</span>, <span class="ruby-identifier">message</span>.<span class="ruby-identifier">headers</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:transaction</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">transaction_id</span>))&#x000A;286:         <span class="ruby-keyword kw">else</span>&#x000A;287:           <span class="ruby-comment cmt"># Poison ack, sending the message to the DLQ</span>&#x000A;288:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">publish</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:dead_letter_queue</span>], <span class="ruby-identifier">message</span>.<span class="ruby-identifier">body</span>, <span class="ruby-identifier">message</span>.<span class="ruby-identifier">headers</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:transaction</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">transaction_id</span>, <span class="ruby-identifier">:original_destination</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">message</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-identifier">:destination</span>], <span class="ruby-identifier">:persistent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>))&#x000A;289:         <span class="ruby-keyword kw">end</span>&#x000A;290:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">commit</span> <span class="ruby-identifier">transaction_id</span>&#x000A;291:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exception</span>&#x000A;292:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">abort</span> <span class="ruby-identifier">transaction_id</span>&#x000A;293:         <span class="ruby-identifier">raise</span> <span class="ruby-identifier">exception</span>&#x000A;294:       <span class="ruby-keyword kw">end</span>&#x000A;295:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000046'>
                <a name='M000046'></a>
                <div class='synopsis'>
                  <span class='name'>unsubscribe</span>
                  <span class='arguments'>(name, headers = {}, subId = nil)</span>
                </div>
                <div class='description'>
                  <p>
                  Unsubscribe from a destination, must specify a name
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000046-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000046-source'>     <span class="ruby-comment cmt"># File lib/stomp/connection.rb, line 235</span>&#x000A;235:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unsubscribe</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">headers</span> = {}, <span class="ruby-identifier">subId</span> = <span class="ruby-keyword kw">nil</span>)&#x000A;236:       <span class="ruby-identifier">headers</span>[<span class="ruby-identifier">:destination</span>] = <span class="ruby-identifier">name</span>&#x000A;237:       <span class="ruby-identifier">transmit</span>(<span class="ruby-value str">&quot;UNSUBSCRIBE&quot;</span>, <span class="ruby-identifier">headers</span>)&#x000A;238:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@reliable</span>&#x000A;239:         <span class="ruby-identifier">subId</span> = <span class="ruby-identifier">name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">subId</span>.<span class="ruby-identifier">nil?</span>&#x000A;240:         <span class="ruby-ivar">@subscriptions</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">subId</span>)&#x000A;241:       <span class="ruby-keyword kw">end</span>&#x000A;242:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
